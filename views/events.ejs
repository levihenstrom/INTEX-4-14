<!-- Events Header -->
<div class="events-header">
    <h1>EVENTS</h1>
    <p>Join us for inspiring workshops, creative experiences, and leadership opportunities that empower the rising
        generation of women in STEAM fields.</p>
</div>

<!-- Upcoming Events Carousel -->
<% if (upcomingEvents && upcomingEvents.length > 0) { %>
<div class="upcoming-events-section">
    <h2 class="upcoming-events-title">Upcoming Events</h2>
    <div class="upcoming-events-carousel-container">
        <button class="carousel-btn carousel-btn-prev" onclick="scrollCarousel('prev')" aria-label="Previous">
            <i class="fa-solid fa-chevron-left"></i>
        </button>
        <div class="upcoming-events-carousel" id="upcomingEventsCarousel">
            <% upcomingEvents.forEach(event => { %>
                <div class="upcoming-event-card">
                    <a href="/registration/<%= event.EventID %>?occurrence=<%= event.OccurrenceID %>" class="upcoming-event-link">
                        <div class="upcoming-event-image">
                            <% const imageSrc = `/images/events/event_${event.EventID}_real.jpg`; %>
                            <img src="<%- imageSrc %>" 
                                 alt="<%= event.EventName %>" 
                                 onerror="this.src='/images/events/event_0_real.png'">
                        </div>
                        <div class="upcoming-event-content">
                            <div class="upcoming-event-header">
                                <h3 class="upcoming-event-name"><%= event.EventName %></h3>
                                <span class="status-badge <%= event.isFull ? 'status-full' : 'status-available' %>">
                                    <i class="fa-solid fa-users"></i>
                                    <%= event.isFull ? 'Full' : 'Space Available' %>
                                </span>
                            </div>
                            <div class="upcoming-event-details">
                                <% if (event.EventLocation) { %>
                                    <div class="upcoming-event-detail">
                                        <i class="fa-solid fa-location-dot"></i>
                                        <span><%= event.EventLocation %></span>
                                    </div>
                                <% } %>
                                <div class="upcoming-event-detail">
                                    <i class="fa-solid fa-calendar"></i>
                                    <span>
                                        <%= new Date(event.EventDateTimeStart).toLocaleDateString('en-US', { 
                                            weekday: 'short', 
                                            month: 'short', 
                                            day: 'numeric',
                                            year: 'numeric'
                                        }) %>
                                    </span>
                                </div>
                                <div class="upcoming-event-detail">
                                    <i class="fa-solid fa-clock"></i>
                                    <span>
                                        <%= new Date(event.EventDateTimeStart).toLocaleTimeString('en-US', { 
                                            hour: 'numeric', 
                                            minute: '2-digit',
                                            hour12: true 
                                        }) %>
                                        <% if (event.EventDateTimeEnd) { %>
                                            - <%= new Date(event.EventDateTimeEnd).toLocaleTimeString('en-US', { 
                                                hour: 'numeric', 
                                                minute: '2-digit',
                                                hour12: true 
                                            }) %>
                                        <% } %>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
            <% }); %>
        </div>
        <button class="carousel-btn carousel-btn-next" onclick="scrollCarousel('next')" aria-label="Next">
            <i class="fa-solid fa-chevron-right"></i>
        </button>
    </div>
</div>
<% } %>

<!-- Events Filters -->
<div class="events-filters">
    <div class="filters-title">Filter Events</div>
    <div class="filters-row">
        <div class="filter-group">
            <label>Event Type</label>
            <div class="event-labels filter-labels" id="event-type-pills">
                <span class="event-label event-label-type-stem filter-pill" data-filter-type="eventType" data-filter-value="all">
                    <i class="fa-solid fa-sliders"></i>All Types
                </span>
                <span class="event-label event-label-type-leadership filter-pill" data-filter-type="eventType" data-filter-value="Leadership">
                    <i class="fa-solid fa-users"></i>Leadership
                </span>
                <span class="event-label event-label-type-stem filter-pill" data-filter-type="eventType" data-filter-value="STEM">
                    <i class="fa-solid fa-gear"></i>STEM
                </span>
                <span class="event-label event-label-type-arts filter-pill" data-filter-type="eventType" data-filter-value="Arts">
                    <i class="fa-solid fa-paintbrush"></i>Arts
                </span>
                <span class="event-label event-label-type-annual-conference filter-pill" data-filter-type="eventType" data-filter-value="Annual Conference">
                    <i class="fa-solid fa-calendar-star"></i>Annual Conference
                </span>
            </div>
        </div>
        <div class="filter-group">
            <label>Recurrence</label>
            <div class="event-labels filter-labels" id="event-recurrence-pills">
                <span class="event-label event-label-recurrence-monthly filter-pill" data-filter-type="eventRecurrence" data-filter-value="all">
                    <i class="fa-solid fa-sliders"></i>All Patterns
                </span>
                <span class="event-label event-label-recurrence-weekly filter-pill" data-filter-type="eventRecurrence" data-filter-value="Weekly">
                    <i class="fa-solid fa-calendar-week"></i>Weekly
                </span>
                <span class="event-label event-label-recurrence-monthly filter-pill" data-filter-type="eventRecurrence" data-filter-value="Monthly">
                    <i class="fa-solid fa-calendar-days"></i>Monthly
                </span>
                <span class="event-label event-label-recurrence-annual filter-pill" data-filter-type="eventRecurrence" data-filter-value="Annual">
                    <i class="fa-solid fa-calendar-check"></i>Annual
                </span>
            </div>
        </div>
        <div class="filter-buttons">
            <button class="filter-btn" onclick="clearFilters()">Clear Filters</button>
        </div>
    </div>
</div>

<!-- Events Grid -->
<div class="events-container">
    <div class="events-grid">
        <% event_templates.forEach(event => { %>
            <div class="event-card-wrapper" 
                 data-event-id="<%= event.EventID %>" 
                 data-event-type="<%= event.EventType || '' %>" 
                 data-event-recurrence="<%= event.EventRecurrencePattern || '' %>" 
                 data-event-capacity="<%= event.EventDefaultCapacity || '' %>">
                <a href="/registration/<%= event.EventID %>" class="event-card">
                    <div class="event-image">
                        <% const imageSrc = `/images/events/event_${event.EventID}_real.jpg`;
                        %>
                        <img src="<%- imageSrc %>" 
                             alt="<%= event.EventName %>" 
                             style="width: 100%; height: 100%; object-fit: cover;"
                             onerror="this.src='/images/events/event_0_real.png'">
                    </div>
                    <div class="event-content">
                        <div class="event-name">
                            <%= event.EventName %>
                        </div>
                        <div class="event-description">
                            <span class="event-description-text">
                                <%= event.EventDescription || 'Join us for this exciting event!' %>
                            </span>
                        </div>
                    </div>
                </a>
            </div>
        <% }); %>
    </div>
</div>

<!-- Filter Functionality -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const eventCardWrappers = document.querySelectorAll('.event-card-wrapper');
        const typePills = Array.from(document.querySelectorAll('#event-type-pills .filter-pill'));
        const recurPills = Array.from(document.querySelectorAll('#event-recurrence-pills .filter-pill'));
        let currentType = 'all';
        let currentRecurrence = 'all';

        function setActive(pills, value) {
            pills.forEach(p => {
                if (p.getAttribute('data-filter-value') === value) {
                    p.classList.add('filter-selected');
                } else {
                    p.classList.remove('filter-selected');
                }
            });
        }

        function filterEvents() {
            eventCardWrappers.forEach(wrapper => {
                const cardType = (wrapper.getAttribute('data-event-type') || '').trim();
                const cardRecurrence = (wrapper.getAttribute('data-event-recurrence') || '').trim();

                const typeOk = currentType === 'all' || cardType === currentType;
                const recurOk = currentRecurrence === 'all' || cardRecurrence === currentRecurrence;
                wrapper.style.display = typeOk && recurOk ? 'block' : 'none';
            });
        }

        typePills.forEach(pill => {
            pill.addEventListener('click', () => {
                const value = pill.getAttribute('data-filter-value');
                currentType = value;
                setActive(typePills, value);
                filterEvents();
            });
        });

        recurPills.forEach(pill => {
            pill.addEventListener('click', () => {
                const value = pill.getAttribute('data-filter-value');
                currentRecurrence = value;
                setActive(recurPills, value);
                filterEvents();
            });
        });

        window.clearFilters = function () {
            currentType = 'all';
            currentRecurrence = 'all';
            setActive(typePills, 'all');
            setActive(recurPills, 'all');
            filterEvents();
        };

        // initialize selection
        setActive(typePills, 'all');
        setActive(recurPills, 'all');
        filterEvents();
    });

    // Carousel functionality
    function scrollCarousel(direction) {
        const carousel = document.getElementById('upcomingEventsCarousel');
        if (!carousel) return;
        
        const cardWidth = carousel.querySelector('.upcoming-event-card').offsetWidth;
        const gap = 32; // 2rem gap
        const scrollAmount = cardWidth + gap;
        
        if (direction === 'prev') {
            carousel.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
        } else {
            carousel.scrollBy({ left: scrollAmount, behavior: 'smooth' });
        }
    }
</script>

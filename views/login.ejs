<div class="auth-page">
<div class="row justify-content-center">
    <div class="col-12 col-md-10 col-lg-10 col-xl-9">
        <!-- Toggle Buttons -->
        <div class="auth-toggle-container">
            <div class="auth-toggle-buttons">
                <button type="button" class="auth-toggle-btn active" data-view="login" id="toggle-login">
                    Login
                </button>
                <button type="button" class="auth-toggle-btn" data-view="register" id="toggle-register">
                    Register
                </button>
            </div>
        </div>

        <!-- Login Form -->
        <div class="auth-card" id="login-form">
            <div class="auth-card-inner">
                <div class="auth-form-side">
                    <div class="auth-card-body">
                        <h2 class="auth-title">User Login</h2>
                <% if (typeof error !== 'undefined' && error && (typeof defaultView === 'undefined' || defaultView === 'login')) { %>
                    <div class="auth-alert"><%= error %></div>
                <% } %>
                <form action="/login" method="POST">
                    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                    <div class="auth-form-group">
                        <label for="ParticipantEmail" class="auth-label">Email</label>
                        <input type="email" class="auth-input" id="ParticipantEmail" name="ParticipantEmail" required autofocus>
                    </div>
                    <div class="auth-form-group">
                        <label for="ParticipantPassword" class="auth-label">Password</label>
                        <input type="password" class="auth-input" id="ParticipantPassword" name="ParticipantPassword" required>
                    </div>
                    <div class="auth-button-group">
                        <button type="submit" class="auth-btn-primary">Log In</button>
                    </div>
                </form>
                    </div>
                </div>
                <div class="auth-image-side">
                    <img src="/images/ella_auth.png" alt="Ella Rises" class="auth-image">
                </div>
            </div>
        </div>

        <!-- Register Form -->
        <div class="auth-card hidden" id="register-form">
            <div class="auth-card-inner">
                <div class="auth-form-side">
                    <div class="auth-card-body auth-register-body">
                        <h2 class="auth-title">Create Your Account</h2>

                <% if (typeof error !== 'undefined' && error && (typeof defaultView !== 'undefined' && defaultView === 'register')) { %>
                    <div class="auth-alert"><%= error %></div>
                <% } %>

                <form action="/register" method="POST">
                    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                    <!-- Name -->
                    <div class="auth-form-group">
                        <label for="ParticipantFirstName" class="auth-label">First Name</label>
                        <input 
                            type="text" 
                            class="auth-input" 
                            id="ParticipantFirstName" 
                            name="ParticipantFirstName" 
                            autofocus 
                            required
                        >
                    </div>
                    <div class="auth-form-group">
                        <label for="ParticipantLastName" class="auth-label">Last Name</label>
                        <input 
                            type="text" 
                            class="auth-input" 
                            id="ParticipantLastName" 
                            name="ParticipantLastName" 
                            required
                        >
                    </div>

                    <!-- Email & Password -->
                    <div class="auth-form-group">
                        <label for="RegisterParticipantEmail" class="auth-label">Email</label>
                        <input 
                            type="email" 
                            class="auth-input" 
                            id="RegisterParticipantEmail" 
                            name="ParticipantEmail" 
                            required
                            pattern="[^@\s]+@[^@\s]+\.[^@\s]+"
                            oninvalid="this.setCustomValidity('Please input a valid email')"
                            oninput="this.setCustomValidity('')"
                        >
                    </div>
                    <div class="auth-form-group">
                        <label for="RegisterParticipantPassword" class="auth-label">Password</label>
                        <input 
                            type="password" 
                            class="auth-input" 
                            id="RegisterParticipantPassword" 
                            name="ParticipantPassword" 
                            required
                        >
                    </div>

                    <!-- DOB -->
                    <div class="auth-form-group">
                        <label for="ParticipantDOB" class="auth-label">Date of Birth</label>
                        <input 
                            type="date" 
                            class="auth-input" 
                            id="ParticipantDOB" 
                            name="ParticipantDOB" 
                            required
                        >
                    </div>

                    <!-- Contact -->
                    <div class="auth-form-group">
                        <label for="ParticipantPhone" class="auth-label">Phone Number</label>
                        <input 
                            type="tel" 
                            class="auth-input" 
                            id="ParticipantPhone" 
                            name="ParticipantPhone"
                            inputmode="numeric"
                            maxlength="12"
                            pattern="\d{3}-\d{3}-\d{4}"
                            title="Phone must be in the format 111-111-1111"
                        >
                    </div>

                    <!-- Location -->
                    <div class="auth-form-group">
                        <label for="ParticipantCity" class="auth-label">City</label>
                        <input 
                            type="text" 
                            class="auth-input" 
                            id="ParticipantCity" 
                            name="ParticipantCity"
                        >
                    </div>
                    <div class="auth-form-group">
                        <label for="ParticipantState" class="auth-label">State</label>
                        <input 
                            type="text" 
                            class="auth-input" 
                            id="ParticipantState" 
                            name="ParticipantState"
                        >
                    </div>
                    <div class="auth-form-group">
                        <label for="ParticipantZip" class="auth-label">ZIP Code</label>
                        <input 
                            type="text" 
                            class="auth-input" 
                            id="ParticipantZip" 
                            name="ParticipantZip"
                        >
                    </div>

                    <!-- School/Employer -->
                    <div class="auth-form-group">
                        <label for="ParticipantSchoolOrEmployer" class="auth-label">
                            School or Employer
                        </label>
                        <input 
                            type="text" 
                            class="auth-input" 
                            id="ParticipantSchoolOrEmployer" 
                            name="ParticipantSchoolOrEmployer"
                        >
                    </div>

                    <!-- Field of Interest -->
                    <div class="auth-form-group">
                        <label class="auth-label">Field of Interest</label>
                        <div class="auth-radio-group">
                            <div class="auth-radio-item">
                                <input 
                                    class="auth-radio" 
                                    type="radio" 
                                    name="ParticipantFieldOfInterest" 
                                    id="interest_stem" 
                                    value="STEM"
                                >
                                <label class="auth-radio-label" for="interest_stem">STEM</label>
                            </div>
                            <div class="auth-radio-item">
                                <input 
                                    class="auth-radio" 
                                    type="radio" 
                                    name="ParticipantFieldOfInterest" 
                                    id="interest_arts" 
                                    value="Arts"
                                >
                                <label class="auth-radio-label" for="interest_arts">Arts</label>
                            </div>
                            <div class="auth-radio-item">
                                <input 
                                    class="auth-radio" 
                                    type="radio" 
                                    name="ParticipantFieldOfInterest" 
                                    id="interest_both" 
                                    value="Both"
                                >
                                <label class="auth-radio-label" for="interest_both">Both</label>
                            </div>
                        </div>
                    </div>

                    <!-- User Type -->
                    <div class="auth-form-group">
                        <label class="auth-label">User Type</label>
                        <div class="auth-radio-group">
                            <div class="auth-radio-item">
                                <input 
                                    class="auth-radio" 
                                    type="radio" 
                                    name="ParticipantRole" 
                                    id="participant" 
                                    value="p"
                                    <%= !isVolunteer ? 'checked' : '' %>
                                >
                                <label class="auth-radio-label" for="participant">Participant</label>
                            </div>
                            <div class="auth-radio-item">
                                <input 
                                    class="auth-radio" 
                                    type="radio" 
                                    name="ParticipantRole" 
                                    id="volunteer" 
                                    value="v"
                                    <%= isVolunteer ? 'checked' : '' %>
                                >
                                <label class="auth-radio-label" for="volunteer">Volunteer</label>
                            </div>
                        </div>
                    </div>

                    <div class="auth-button-group">
                        <button type="submit" class="auth-btn-primary">
                            Register Account
                        </button>
                    </div>
                </form>
                    </div>
                </div>
                <div class="auth-image-side">
                    <img src="/images/ella_register.jpeg" alt="Ella Rises" class="auth-image">
                </div>
            </div>
        </div>
    </div>
</div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Get default view from server (passed as EJS variable)
        const defaultView = '<%= typeof defaultView !== "undefined" ? defaultView : "login" %>';
        
        // Toggle function with smooth transitions
        function toggleView(view) {
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            const loginBtn = document.getElementById('toggle-login');
            const registerBtn = document.getElementById('toggle-register');
            
            if (view === 'login') {
                // Fade out register, fade in login
                registerForm.classList.add('fade-out');
                setTimeout(() => {
                    registerForm.classList.add('hidden');
                    registerForm.classList.remove('fade-out', 'fade-in');
                    
                    loginForm.classList.remove('hidden', 'fade-out');
                    loginForm.classList.add('fade-in');
                    setTimeout(() => {
                        loginForm.classList.remove('fade-in');
                    }, 50);
                }, 200);
                
                loginBtn.classList.add('active');
                registerBtn.classList.remove('active');
                // Update URL without reload
                window.history.replaceState({}, '', '/login');
            } else {
                // Fade out login, fade in register
                loginForm.classList.add('fade-out');
                setTimeout(() => {
                    loginForm.classList.add('hidden');
                    loginForm.classList.remove('fade-out', 'fade-in');
                    
                    registerForm.classList.remove('hidden', 'fade-out');
                    registerForm.classList.add('fade-in');
                    setTimeout(() => {
                        registerForm.classList.remove('fade-in');
                    }, 50);
                }, 200);
                
                loginBtn.classList.remove('active');
                registerBtn.classList.add('active');
                // Update URL without reload
                window.history.replaceState({}, '', '/register');
            }
        }
        
        // Set initial view based on route
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const loginBtn = document.getElementById('toggle-login');
        const registerBtn = document.getElementById('toggle-register');
        
        // Set initial state without animation
        if (defaultView === 'login') {
            loginForm.classList.remove('hidden');
            registerForm.classList.add('hidden');
            loginBtn.classList.add('active');
            registerBtn.classList.remove('active');
        } else {
            loginForm.classList.add('hidden');
            registerForm.classList.remove('hidden');
            loginBtn.classList.remove('active');
            registerBtn.classList.add('active');
        }
        
        // Add event listeners to toggle buttons
        document.getElementById('toggle-login').addEventListener('click', function() {
            toggleView('login');
        });
        
        document.getElementById('toggle-register').addEventListener('click', function() {
            toggleView('register');
        });

        // Live phone formatting: 111-111-1111
        const phoneInput = document.getElementById('ParticipantPhone');
        if (phoneInput) {
            phoneInput.addEventListener('input', function () {
                // Strip all non-digits
                let digits = phoneInput.value.replace(/\D/g, '');

                // Limit to 10 digits
                if (digits.length > 10) {
                    digits = digits.slice(0, 10);
                }

                let formatted = '';
                if (digits.length > 0) {
                    formatted = digits.substring(0, 3);
                }
                if (digits.length >= 4) {
                    formatted += '-' + digits.substring(3, 6);
                }
                if (digits.length >= 7) {
                    formatted += '-' + digits.substring(6, 10);
                }

                phoneInput.value = formatted;
            });
        }
    });
</script>